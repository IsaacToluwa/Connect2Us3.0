@model book2us.Controllers.SellerDashboardViewModel

@{
    ViewBag.Title = "Seller Dashboard";
}

<div class="container-fluid">
    <h2>Seller Dashboard</h2>
    
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    <!-- Payment Summary Card -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4>Payment Summary - This Month</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>Book Sales</h5>
                                <h3 class="text-success">R @Model.PaymentSummary.TotalBookSales.ToString("F2")</h3>
                                <small>@Model.PaymentSummary.CompletedOrders orders completed</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>Print Revenue</h5>
                                <h3 class="text-info">R @Model.PaymentSummary.TotalPrintRevenue.ToString("F2")</h3>
                                <small>@Model.PaymentSummary.CompletedPrintJobs print jobs completed</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>Delivery Commission</h5>
                                <h3 class="text-warning">R @Model.PaymentSummary.TotalCommission.ToString("F2")</h3>
                                <small>20% of delivery fees</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>Total Earnings</h5>
                                <h3 class="text-dark">R @((Model.PaymentSummary.TotalBookSales + Model.PaymentSummary.TotalPrintRevenue + Model.PaymentSummary.TotalCommission).ToString("F2"))</h3>
                                <small>Combined earnings</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Assigned Print Requests -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-warning">
                    <h4>Assigned Print Requests</h4>
                </div>
                <div class="card-body">
                    @if (Model.AssignedPrintRequests.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Pages</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var request in Model.AssignedPrintRequests)
                                    {
                                        <tr>
                                            <td>@request.PrintingRequestId</td>
                                            <td>@request.TotalPages</td>
                                            <td>
                                                <span class="badge badge-@(request.Status == "Processing" ? "warning" : request.Status == "Ready" ? "success" : "secondary")">
                                                    @request.Status
                                                </span>
                                            </td>
                                            <td>
                                                @Html.ActionLink("Details", "PrintRequestDetails", new { id = request.PrintingRequestId }, new { @class = "btn btn-sm btn-info" })
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            @Html.ActionLink("View All Print Requests", "PrintRequests", null, new { @class = "btn btn-warning" })
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted">
                            <p>No assigned print requests</p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success">
                    <h4>Recent Orders</h4>
                </div>
                <div class="card-body">
                    @if (Model.RecentOrders.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Total</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var order in Model.RecentOrders)
                                    {
                                        <tr>
                                            <td>@order.OrderId</td>
                                            <td>@order.OrderDate.ToString("MM/dd/yyyy")</td>
                                            <td>R @order.Total.ToString("F2")</td>
                                            <td>
                                                @Html.ActionLink("Details", "OrderDetails", new { id = order.OrderId }, new { @class = "btn btn-sm btn-info" })
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            @Html.ActionLink("View All Orders", "Orders", null, new { @class = "btn btn-success" })
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted">
                            <p>No recent orders</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- My Books Section -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info d-flex justify-content-between align-items-center">
                    <h4>My Books</h4>
                    @Html.ActionLink("Create New Book", "Create", null, new { @class = "btn btn-light" })
                </div>
                <div class="card-body">
                    @if (Model.MyBooks.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Author</th>
                                        <th>Price</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var book in Model.MyBooks)
                                    {
                                        <tr>
                                            <td>@book.Title</td>
                                            <td>@book.Author</td>
                                            <td>R @book.Price.ToString("F2")</td>
                                            <td>
                                                @Html.ActionLink("Edit", "Edit", new { id = book.Id }, new { @class = "btn btn-sm btn-warning" }) |
                                                @Html.ActionLink("Details", "Details", new { id = book.Id }, new { @class = "btn btn-sm btn-info" }) |
                                                @Html.ActionLink("Delete", "Delete", new { id = book.Id }, new { @class = "btn btn-sm btn-danger" })
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted">
                            <p>You haven't created any books yet.</p>
                            @Html.ActionLink("Create Your First Book", "Create", null, new { @class = "btn btn-info" })
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-refresh dashboard every 30 seconds
        setTimeout(function() {
            location.reload();
        }, 30000);
    </script>
}