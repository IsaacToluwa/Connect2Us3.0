@model IEnumerable<book2us.Models.PrintingRequest>

@{
    ViewBag.Title = "Print Requests";
}

<div class="container-fluid">
    <h2>Print Requests</h2>
    
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    <div class="card">
        <div class="card-body">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Request ID</th>
                                <th>Customer</th>
                                <th>Pages</th>
                                <th>Cost</th>
                                <th>Status</th>
                                <th>Request Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var request in Model)
                            {
                                <tr>
                                    <td>@request.PrintingRequestId</td>
                                    <td>@(request.User?.UserName ?? "Unknown")</td>
                                    <td>@request.TotalPages</td>
                                    <td>R @(request.PrintingCost?.ToString("F2") ?? "Pending")</td>
                                    <td>
                                        <span class="badge badge-@(request.Status == "Processing" ? "warning" : 
                                                                 request.Status == "Ready" ? "success" : 
                                                                 request.Status == "Completed" ? "primary" : 
                                                                 request.Status == "Cancelled" ? "danger" : "secondary")">
                                            @request.Status
                                        </span>
                                    </td>
                                    <td>@request.RequestDate.ToString("MM/dd/yyyy HH:mm")</td>
                                    <td>
                                        @Html.ActionLink("Details", "PrintRequestDetails", new { id = request.PrintingRequestId }, new { @class = "btn btn-sm btn-info" })
                                        
                                        @if (request.Status == "Processing")
                                        {
                                            using (Html.BeginForm("UpdatePrintRequestStatus", "Seller", new { id = request.PrintingRequestId, status = "Ready" }, FormMethod.Post, new { @class = "d-inline" }))
                                            {
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="btn btn-sm btn-success" onclick="return confirm('Mark this print request as ready?');">Mark Ready</button>
                                            }
                                        }
                                        
                                        @if (request.Status == "Ready" && request.FulfillmentMethod == "Delivery")
                                        {
                                            using (Html.BeginForm("UpdatePrintRequestStatus", "Seller", new { id = request.PrintingRequestId, status = "Completed" }, FormMethod.Post, new { @class = "d-inline" }))
                                            {
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="btn btn-sm btn-primary" onclick="return confirm('Confirm delivery completion?');">Mark Delivered</button>
                                            }
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center text-muted">
                    <p>No print requests assigned to you.</p>
                </div>
            }
        </div>
    </div>
    
    <div class="mt-3">
        @Html.ActionLink("Back to Dashboard", "Index", null, new { @class = "btn btn-secondary" })
    </div>
</div>